---
layout: post
title: Conditional Compilation
tags:
- autoconf
- computer science
- make
status: publish
type: post
published: true
meta:
  _edit_last: '2'
---
Last week I had the (dis)pleasure of porting some code to Mac, and today it came time to merge with the original codebase. As helpful as it was to use macros for different code paths, we needed something in the makefile to optionally add flags when compiling on Mac.
<code>
// This is all well and good
#ifndef __APPLE__
    // Do your Linux-y includes here
#else
    // Do your Apple-y includes here
#endif
</code>

Apparently, there are a couple conventions for doing this. First, you can inject a configuration step (Ã  la autoconf, for example) which would detect what platform you're building on in a robust way and build a Makefile for you. Second, if you're lazy or autoconf would be like hitting a fly with a hammer, you can use make's conditionals:
<code>
# Ensure that this gets declared in time,
# and fill it with the result of `uname`
UNAME := $(shell uname)

# If the environment is Darwin...
ifeq ($(UNAME), Darwin)
    CXXFLAGS = # Something Apple-y
else
    CXXFLAGS = # Something Linux-y
endif
</code>

Simple enough!
