
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>My Octopress Blog</title>
  <meta name="author" content="Your Name">

  
  <meta name="description" content="Until recently, I bore the burden of a dirty little secret: I didn’t use unit testing. I don’t know if this has been other students’ experience, but &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://dlecocq.github.com/blog/page/4">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39246569-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>



  <!-- MathJax -->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>

  <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
  </script>

  <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
  </script>

  <script type="text/javascript"
     src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My Octopress Blog</a></h1>
  
    <h2>A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:dlecocq.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/31/things-i-wish-software-engineering-pounded-into-my-head/">Things I Wish Software Engineering Pounded Into My Head</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-31T00:00:00-07:00" pubdate data-updated="true">May 31<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Until recently, I bore the burden of a dirty little secret: I didn’t use unit testing. I don’t know if this has been other students’ experience, but my software engineering course could have been a lot better. Perhaps it’s a topic that requires students to determine their own level of involvement, but particularly, I am irked that these issues were not as developed as they could have been:</p>
<ol>	
	<li>Version control - svn, git, something! Anything, really! Just use something!</li>
	<li>Unit testing - sure we talked about it, but its utility isn&#8217;t clear until you use it in earnest</li>
	<li>Documentation - always felt more like a chore than a tool</li>
	<li>Issue tracking - <a href="http://www.joelonsoftware.com/articles/fog0000000029.html">Joel on Software</a> said it best: &#8220;I was born with only two bug-storing-slots in my brain.&#8221;</li>
	<li>More best practices - <a href="http://www.aristeia.com/books.html">Effective C++</a> (it&#8217;s worth it &#8211; get it and read it) alone was worth more than the course was.


I concede that these are things whose utility might be hard to convey to college students who may or may not be working on projects they really believe in. Still, very important.

One of the things I like about documentation is that you can refer to the documentation when uncertain about side-effects, input, etc. of functions and you don&#8217;t really feel like reading through code and trying to keep it in your brain-RAM. Not only that, but I usually refer to my own documentation to get an idea of the guarantee that a function was offering, to try to make sure that it&#8217;s making those <strong>same guarantees after I make changes</strong>. Not only this, but <strong>articulating functionality crystalizes it&#8217;s implications</strong> in your mind. When describing how something works to a friend, it often reminds you of issues you hadn&#8217;t considered. Writing documentation is the same in this respect.

When working with other people, while it&#8217;s nice to be able to talk face-to-face, the issues we think of that need changing go in one ear and out the other for me. Not that it wasn&#8217;t a good idea, but my brain-RAM is not infinite. <strong>Bugs, features, ideas, issues all get paged out of my head. Write them down instead,</strong> which is where issue tracking comes in. Design questions and decisions come out of issues all the time, and the trail of comments and discussion make a nice reference for documentation.

I find that when I&#8217;m fixing a bug, the functionality of that chunk of code gets reduced to that particular feature in my mind. So, if when I try using it, if that bug is fixed, then my job is done. But we&#8217;ve all experienced unintended side effects, where in fixing one thing, we break another. Having a list of features to check is a step up from trying to remember the things that need to work, but it&#8217;s much less than the power of unit testing. I&#8217;ve recently been using <a href="http://unittest-cpp.sourceforge.net/UnitTest++.html">UnitTest++</a> for C++ applications, and <a href="http://docs.jquery.com/QUnit">QUnit</a> from the jQuery people, and have been pleased to thrilled. It allows you to <strong>check functionality exhaustively and quickly on a whim</strong>. Even the task of <strong>writing the tests forces you to define the functional requirements of your code</strong>, and I find it helps to clarify a lot.

Version control lets you try crazy new approaches and track changes, isn&#8217;t that great? I was helping a friend last semester with some of his code, and he was trying to make code changes with copy, paste, and the undo buffer. In the end, he ended up introducing more bugs into the code than he was fixing. <strong>It&#8217;s intractable to keep these kinds of code changes in your brain-RAM.</strong> Use something, use anything. I have a qualm with svn because it was something I used so rarely, I could never remember how to set it up. <strong>Even a barrier as small as that was enough to prevent me from using version control at all.</strong> I love git because it&#8217;s so easy to set up, I use it for almost anything: from a report (if using LaTeX), to a weekend project, to my thesis. There are tons of tools out there, but <strong>just use something.</strong>
</li></ol>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/18/python-lesson-learned/">Python Lesson Learned</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-18T00:00:00-07:00" pubdate data-updated="true">May 18<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have finally learned a lesson after running into this fact repeatedly: no matter what you are trying to do, python has a module for it. I’m reminded of two <a href="http://xkcd.com/353/">xkcd comics</a> in <a href="http://xkcd.com/413/">particular</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/10/sum-of-dice/">Sum of Dice</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-10T00:00:00-07:00" pubdate data-updated="true">May 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently had an interview in which I was asked, “how many ways can 1000 dice make the sum 3000?” I was caught a little off-guard, and the phrasing made me wonder about a closed-form solution which, after some reading, I don’t believe exists. Still, a workable solution isn’t as easy as that.</p>

<p>Let <em>F(n, k)</em> denote the number of ways <em>n</em> dice can make the sum <em>k</em>. Note that the first die can be 1, 2, 3, 4, 5 or 6, so <em>F(1000, 3000) = F(999, 2999) + F(999, 2998) + … + F(999, 2994)</em>. While this recurrence relation leads to an easy implementation, it suffers from two big problems: performance and maximum recursion depth. Without any <a href="http://en.wikipedia.org/wiki/Memoization">memoization</a> or optimization, this would lead to 6<sup>1000</sup> function calls, which is about 10<sup>780</sup>. That’s a big number. If you were able to evaluate one such function call every clock cycle on every computer in the world (about 7 x 10<sup>18</sup> cycles/second), you would need about 10<sup>750</sup> years, or 10<sup>650</sup> lifetimes of the universe (about 10<sup>100</sup> years) to solve it. Get ready to wait.</p>

<p>One optimization is to check if the arguments n and k make sense at each level, and prune accordingly. For example, n dice can only sum to between n and 6n, so if k is outside of that range, you don’t need to branch down any farther. Even using this and instantaneous branch evaluation, your code still wouldn’t complete in the expected lifetime of the universe.</p>

<p>Obviously, this is still a solvable problem (there are about 10<sup>757</sup> ways 1000 dice can sum to 3000). A python implementation figured that out in 3.5 seconds. One way to help crack this egg is to use memoization. Consider the calls to <em>F(999, 2999)</em> and <em>F(999, 2998)</em>. Expand these out to get:</p>

<script type="math/tex; mode=display">
F(999, 2999) = sum[F(998, k = 2998, 2997, 2996, 2995, 2994, 2993)] \\
F(999, 2998) = sum[F(998, k = 2997, 2996, 2995, 2994, 2993, 2992)]
</script>

<p>You’ll notice that both of these expansions call <em>F(998, k = 2997, 2996, 2995, 2994, 2993)</em>, each of which is a <em>lot</em> of work to evaluate. So, if once you determined each of these values once, you could use them in other places and save huge amounts of time.</p>

<p>One thing you’d need in order to implement memoization is a map (or dictionary in python) that stores key-value pairs. So once you figure out <em>F(998, 2997)</em>, you could store it like <em>myMap[(998, 2997)] = …</em>; but this can add some complication. Every time to call F, you’d have to check if you’ve already evaluated the function for those arguments. And when you’ve figured out and stored a lot of these values, each search will take some time. It will still work and will get you the answer you need, but probably not as fast as you’d like, and not as fast as it could be. Using memoization for <em>F(700, 2100)</em> took 8.2 seconds in a python implementation, but a better approach took 1.5 seconds. The maximum recursion depth prevented it from using bigger numbers.</p>

<p>Algorithmically, the best you’ll be able to do (as far as I can tell) is <em>O(n<sup>2</sup>)</em>, which is not bad in the scheme of things, and certainly not the combinatoric time we saw first. Enter dynamic programming. Particularly, we’ll use a <a href="http://en.wikipedia.org/wiki/Top-down_and_bottom-up_design">bottom-up approach</a>. We’ll build two arrays, each associated with a number of dice. The <em>i</em>‘th index in that array is the number of ways n dice can sum up to <em>(n + i)</em>. So for 1 die, <em>myArray[0]</em> is the number of ways you can roll a 1, and for 4 dice, <em>myArray[10]</em> would be the number of ways you can roll 4 dice to get 14.</p>

<p>As I said, we’ll keep track of two arrays, say <em>previous</em> and <em>current</em>. First, initialize previous to be the number of ways 1 die can be rolled: <em>{1, 1, 1, 1, 1, 1}</em>, because 1 die can be rolled each number in only one way. Then, we’ll use that to fill the array “current” with the number of ways 2 dice can be rolled, based on the array <em>previous</em>. For example, <em>current[0] = previous[0] = 1</em>, because the only way to get a sum of n with n dice is to roll all 1’s. Then, <em>current[1] = previous[0] + previous[1]</em>, because if we roll a 2 for the second dice, there are <em>previous[0]</em> ways to sum up to 1 with the remaining die, or if we roll a 1 for the second dice, there are <em>previous[1]</em> ways to sum up to 2 with the remaining die.</p>

<p>Each entry <em>current[i]</em> should be the sum of <em>previous[i-5, i-4, i-3, i-2, i-1, i]</em>, taking the bounds of the previous array into consideration (this can actually be generalized to any <em>m</em>-sided dice by using previous[i-m+1, …, i]). Once you’ve filled the array <em>current</em>, then you assign current to previous, and move on to the next number of dice, 3. Continue this until you have filled the array for the desired number of dice. If performance is a big issue, this can be implemented as a moving frame. For example, since <em>current[i]</em> uses <em>previous[i-5, …, i]</em> and <em>current[i+1]</em> uses <em>previous[i-4, …, i+1]</em>, you can alternatively write <em>current[i+1] = current[i] - previous[i-5] + previous[i+1]</em>, and use only two add/subtract operations instead of 5.</p>

<p>A bonus to this bottom-approach is that once finished, you actually have an array with the number of ways you can make <em>any</em> sum with the <em>n</em> dice. This makes it easy if you wish to find the number of ways <em>n</em> dice can form a sum <em>up to</em> or <em>greater than</em> a number.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/05/10/numerical_limits/">Numerical_limits</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-10T00:00:00-07:00" pubdate data-updated="true">May 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I’m working on a C++ class that encapsulates changes to a “steerable” variable. It’s part of a system that allows trusted commands from a socket library to change the value of registered variables. For example, a client might:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">int</span> <span class="n">sInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class="line"><span class="kt">float</span> <span class="n">sFloat</span><span class="p">(</span><span class="mf">0.3</span><span class="p">);</span>
</span><span class="line"><span class="n">registerParam</span><span class="p">(</span><span class="s">&quot;someSteerableInteger&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sInt</span><span class="p">);</span>
</span><span class="line"><span class="n">registerParam</span><span class="p">(</span><span class="s">&quot;someSteerableFloat&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sFloat</span><span class="p">);</span>
</span><span class="line"><span class="p">...</span>
</span><span class="line"><span class="c1">// Library makes these calls after receiving remote commands:</span>
</span><span class="line"><span class="n">setParam</span><span class="p">(</span><span class="s">&quot;someSteerableInteger&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
</span><span class="line"><span class="n">setParam</span><span class="p">(</span><span class="s">&quot;someSteerableFloat&quot;</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>There’s some intelligence in the class to ensure integrity of the data. For example, it will cast the value passed into <code>setParam(...)</code> correctly, so that a call to <code>setParam("someSteerableInteger", 5.3)</code> results in the 5.3 cast as an integer and then used to set the integer’s value.</p>

<p>Some of the other intelligence needed is that the user might specify the minimum and maximum valid values the variable might take on. Or he or she might not. If not, it would be nice to have a convenient way of specifying a reasonable default minimum and maximum.</p>

<p>Enter <em><a href="http://www.cplusplus.com/reference/std/limits/numeric_limits/">numerical_limits</a></em>. It’s a static templated class that can give you some insight into the built-in types. For example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="cp">#include &amp;lt;iostream&amp;gt;</span>
</span><span class="line"><span class="cp">#include &amp;lt;limits&amp;gt;</span>
</span><span class="line"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class="line"><span class="p">...</span>
</span><span class="line"><span class="n">cout</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="s">&quot;Min unsigned int: &quot;</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">numerical_limits</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">::</span><span class="n">min</span><span class="p">()</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class="line"><span class="n">cout</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="s">&quot;Max float: &quot;</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">numerical_limits</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="kt">float</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">::</span><span class="n">max</span><span class="p">()</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">endl</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/03/03/efficient-anagrams-with-python/">Efficient Anagrams With Python</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-03-03T00:00:00-08:00" pubdate data-updated="true">Mar 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I love anagrams. I used to play an anagram game so often that I started to have trouble reading, as I would just automatically try to find anagrams of words. One way I’m able to stop playing an addictive game altogether is to write code that will solve the problem at hand for me. For example, at one point I had to do just that with Sudoku so I could reclaim my time.</p>

<p>There are a few thoughts that I’ve seen on finding anagrams with python, including some pretty concise examples. They center around finding all the permutations of a provided set of letters, and then checking these against known words. While this can be extremely concisely done with python’s <a href="http://docs.python.org/library/itertools.html">itertools</a>, it quickly becomes prohibitively slow for longer strings. That’s because the number of permutations it must calculate for a word of length ‘n’ is n!, much too large for reasonable n’s.</p>

<p>To clarify, in this discussion, by ‘anagram,’ we will mean any word made with the letters, of any length 1 to n. So, for the word “foobar,” then “fob” or “boo” would be valid.</p>

<p>There is some good news here. Pruning. With some intelligence and time up front, we can skip all permutations that begin with “fb,” as no word in our dictionary begin with those letters. We use a tree, with each node representing a string. A node marked as ‘valid,’ indicates that its associated string is a word. This string is obtained by the traversal from the root to the node.</p>

<p>[caption id=”attachment_920” align=”aligncenter” width=”323” caption=”Anagram tree structure”]<a href="http://dan.lecocq.us/wordpress/wp-content/uploads/2011/03/anagrams.png"><img src="http://dan.lecocq.us/wordpress/wp-content/uploads/2011/03/anagrams.png" alt="Tree structure" title="anagrams" width="323" height="369" class="size-full wp-image-920" /></a>[/caption]</p>

<p>So, if we have the letters “uueeq,” we have a set of permutations beginning with “u”, a set with “e” and a set with “q.” We’ll begin with the root node, and for ease, we’ll examine permutations beginning with “q.” Of the remaining letters, “uuee,” there are only children from “q” to “u,” and so we can prune permutations beginning “qe.” We get words by keeping track of the string we have as we traverse the tree - each time we descend to a child node, we append that character, and when we return up a letter, we remove it.</p>

<p>As we traverse in this way, we check all intermediate nodes to see if they themselves are words. For example, in finding “batting,” we should also find that the word “bat” is valid. Or similar, in finding “quotable,” we should find “quota.”</p>

<p>If you don’t feel like working out the details yourself, I have some <a href="http://dan.lecocq.us/wordpress/wp-content/uploads/2011/03/gramana.py">sample code</a> for you. To use:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="python"><span class="line"><span class="kn">from</span> <span class="nn">gramana</span> <span class="kn">import</span> <span class="n">gramana</span>
</span><span class="line"><span class="c"># Read a list of valid words</span>
</span><span class="line"><span class="n">words</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="s">&#39;dictionary.txt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</span><span class="line"><span class="c"># Parse it into a tree</span>
</span><span class="line"><span class="n">root</span> <span class="o">=</span> <span class="n">gramana</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
</span><span class="line"><span class="c"># Look for words:</span>
</span><span class="line"><span class="n">anagrams</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&quot;testingsomeverylongstring&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/02/24/wrapping-printf/">Wrapping Printf(1)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-24T00:00:00-08:00" pubdate data-updated="true">Feb 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Working on an application that had become a little… verbose, I decided it was finally time to wrap my prints in a function that could easily be switched on or off depending on whether or not I wanted it to be verbose.  One approach I had seen before (from my OS professor) that has a certain amount of merit is to wrap statements with a macro:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="cp">#ifdef DEBUG</span>
</span><span class="line"><span class="n">printf</span><span class="p">(....);</span>
</span><span class="line"><span class="cp">#endif</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The nice thing about this approach is that debugging can be turned on or off easily at compile time.  However, my experience has been that it leads to a lot of typing, and seeing too many macros in the middle of code makes my brain explode in a fiery rage.  So, I figured that if I wrapped my prints in another function (I called mine ‘log’ and ‘error’), I could avoid this whole mess and keep my sanity.  I’ve done this with a number of other projects in other languages, but I had to learn some magic to do it in C.</p>

<p>Lesson Learned #1 : Variable arguments. It turns out you can define functions that take a variable number of arguments with <code>va_list</code> (from <a href="http://en.wikipedia.org/wiki/Stdarg.h"><code>&lt;stdarg.h&gt;</code></a>).  You define such a function:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">void</span> <span class="n">log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
</span><span class="line">    <span class="n">va_list</span> <span class="n">args</span><span class="p">;</span>
</span><span class="line">    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
</span><span class="line">    <span class="p">...</span>
</span><span class="line">    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Lesson Learned #2 : However, from what I can gather, you can’t just inject printf directly into this. However, having anticipated this, there is a set of functions designed for cases like this: <code>vfprintf</code>, <code>vprintf</code>, <code>vsnprintf</code>, <code>vsprintf</code>. The ‘v’ stands for <code>va_list</code> (variable-argument list), and you can use them just like you’d expect:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">void</span> <span class="n">log</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
</span><span class="line">    <span class="n">va_list</span> <span class="n">args</span><span class="p">;</span>
</span><span class="line">    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
</span><span class="line">    <span class="n">fprintf</span><span class="p">(</span><span class="n">log_fd</span><span class="p">,</span> <span class="s">&quot;NOTE : &quot;</span><span class="p">);</span>
</span><span class="line">    <span class="n">vfprintf</span><span class="p">(</span><span class="n">log_fd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
</span><span class="line">    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The thing I like about this approach is that you have control over how log messages get printed in <em>one</em> place.  So, for example, if I provided another function, <em>setLogFD</em>, then I could easily just set the file descriptor where all log messages get printed.  So easy!  Something I’ve used this for in other instances (especially servers) is to also inject additional information like a timestamp on every message.  So, when I call:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="n">log</span><span class="p">(</span><span class="s">&quot;Some event &#39;%s&#39; just happened.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">event_name</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Then I automatically get “NOTE : “ and maybe a timestamp prefixed on that message.  Which make code look clean, and adds a great deal of functionality.  I actually added another function <em>error(…)</em> that prints to a different file descriptor in case I want to suppress debug messages, but no error messages.  For additional layers of debugging, you might do something like this:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">void</span> <span class="n">log</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fmt</span><span class="p">,</span> <span class="p">...)</span> <span class="p">{</span>
</span><span class="line">    <span class="n">va_list</span> <span class="n">args</span><span class="p">;</span>
</span><span class="line">    <span class="n">va_start</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">fmt</span><span class="p">);</span>
</span><span class="line">    <span class="n">FILE</span><span class="o">*</span> <span class="n">fd</span> <span class="o">=</span> <span class="n">my_log_files</span><span class="p">[</span><span class="n">level</span><span class="p">];</span>
</span><span class="line">    <span class="n">fprintf</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s">&quot;NOTE : &quot;</span><span class="p">);</span>
</span><span class="line">    <span class="n">vfprintf</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
</span><span class="line">    <span class="n">va_end</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This way, at startup, you could easily set some of the file descriptors in <em>my_log_files</em> to stderr and some to point to /dev/null or otherwise dissolve into the ether.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/25/rename2/">Rename(2)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-25T00:00:00-08:00" pubdate data-updated="true">Nov 25<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I found myself needing to systematically rename a bunch of files, and previously the only way I knew to do it was with a loop, passing each filename into sed, and using the output as the destination filename.  Tedious and error prone!</p>

<p>However, it turns out that people have anticipated this use case, and there is a utility for this exact purpose, called “rename.”  It allows you to provide a perl-style regular expression whose input is the existing filename found by your search expression, and whose output is what that file should be renamed.  There’s even an <em>especially useful option</em> to take no action, but only to print out what the new filenames would be, allowing you to perform a dry-run before you rename 100000 files.</p>

<p>Example:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line">rename -n <span class="s1">&#39;s/^/some.file.prefix./&#39;</span> *.jpg
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Happy renaming!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/22/spokepov/">SpokePOV</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-22T00:00:00-07:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When moving to Saudi Arabia, it is important to bring hobbies. Some have video games. Others learn to dive or windsurf. Considering this fact when returning this most recent time, I bought a <a href="http://www.ladyada.net/make/spokepov/">SpokePOV kit</a> from the nice folks at <a href="http://adafruit.com/">adafruit industries</a>.</p>

<p>Short story is it works by attaching these microcontroller-controlled strips of LEDs to the spokes of your bike tire.  These then monitor the rate at which the wheels are moving (they sense a magnet places on the fork), and based on that, quickly turn on and off the various LEDs to form a pattern.  If the wheel then spins fast enough, then your eyes perceive it as a static image.  A long exposure does the same trick:</p>

<p><a href="http://www.flickr.com/photos/danlecocq/5014080439/" title="DSC_0002.NEF by danlecocq, on Flickr"><img class="aligncenter" src="http://farm5.static.flickr.com/4090/5014080439_5591e3bb9c.jpg" width="500" height="334" alt="DSC_0002.NEF" /></a></p>

<p>It took maybe 7 or 8 hours of soldering (it was a slow start initially), and worked right off the bat.  That is something I was particularly pleased with, as in my chosen field, code very rarely works correctly the first time.</p>

<p>Unfortunately over the summer my soldering iron disappeared from my apartment, and so I went looking for a new one.  Our local supermarket, Tamimi (the Saudi Safeway franchise) sells soldering irons, but does not sell solder.  Finding suitable solder was the mission of three days of biking back and forth between campus and downtown Thuwal.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/24/falling-to-the-earth/">Falling to the Earth</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-24T00:00:00-07:00" pubdate data-updated="true">Aug 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Earlier this summer, I agreed to go skydiving with my friend Chris.  Yesterday, we finally took the jump.</p>

<p><a href="http://www.mile-hi-skydiving.com/">Mile-Hi Skydiving</a> is only about 20 minutes from where my parents live, and accept walk-ins.  We showed up, signed away our lives and after a wait (after all, we didn’t make reservations), we were introduced to the instructors we’d be strapped to.  I can’t speak for Chris, but the guy helping me out, Dave, was disconcertingly quiet when getting set up.  He handed me a suit, and helped me put on a harness that loops around each leg, the torso and finally straps over the shoulders.</p>

<p>After a short wait, a truck with a flatbed trailer drove up, and about 12 people hopped on.  There were two other people in our group making a tandem dive, as well as a few others making solo jumps (including one guy wearing a <a href="http://en.wikipedia.org/wiki/Wingsuit_flying">squirrel suit</a>).  We drive up to a plane whose propeller is roaring making it difficult to hear the guy next to you, and are packed into two benches facing each other.  At this point the reality of the situation really began to hit me, and was compounded by the fact that the guy I would tumble to the ground with hadn’t yet told me anything that would be happening!</p>

<p>We were cleared for takeoff and began to climb.  A few more experienced guys at the back held the door open for a while during our ascent, and it was relatively unsettling to see an open door on a plane like that.  Eventually Dave told me to sit on his lap and he began hooking my harness to him and his parachute and tightening straps.  “When we go out, don’t jump – I’m going to push you.  Hold on here, and tuck your legs back and I’ll let you know when you can let go.”  At this point, the solo jumpers were beginning to hop out.  Dave hands me goggles and we move towards the door, and before I realize it, we’re tumbling out of a plane.</p>

<p>Instantly the speed of wind rushing past registers, thick as soup.  Trying to concentrate, I remember to tuck my legs back and Dave locks legs to position us correctly, turning us ever so often to admire the view.  It really was akin to zooming in on Google Earth, except for the attenuation of light from the distance, and the freezing air flapping violently at you.  From Longmont’s Vance Brand Airport, we could see Boulder and Longmont laid out in front of us.  I had expected that during freefall I would feel the same feeling in my stomach as when an airplane experiences turbulence, or an elevator sometimes jolts.  The feeling of gravity giving out, and the instinct to grab onto something.  Though, after the first few seconds (during which we were tumbling) there was nothing of the sort.</p>

<p>After about a minute, I felt Dave reach for something and I figure it’s him deploying the parachute.  For a split second I wondered what to anticipate, and then I felt a strong tug upwards and suddenly we were upright.  He adjusted my straps for this position, which felt a bit like being unharnessed.  I took on a sitting position in the harness and enjoyed the view when Dave began, “let’s talk about the landing.”</p>

<p>It was another couple of minutes before we finally touched down, and it was all a bit too much to take in during one jump.  On the flight up, I was certain that I would never try this a second time, but now, I have a feeling it won’t be the last time I jump out of a perfectly good airplane.</p>

<p>I highly recommend the experience to anyone and everyone.  Especially as some have recently been <a href="http://lifehacker.com/5608980/spend-on-experiences-instead-of-possessions-for-longer-happiness">suggesting that experiences are more enjoyed than possessions</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/22/mpi_datatype/">MPI_Datatype</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-22T00:00:00-07:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It has been a while since I’ve had to work with MPI, but recently I had to learn a new trick with it.  MPI provides ways to convey data between processes in a number of ways, from broadcasts to scatters to all-gathers.  But obviously you have to provide a certain amount of information about the structure of the data, not the least of which is the datatype.</p>

<p>MPI defines enumerated constants for the basic data types in C: MPI_CHAR, MPI_INT, etc., and for the most part these will suffice.  But what if you want to scatter your own struct?  This can be done through a number of utility functions, but the most versatile seems to be MPI_Type_struct().</p>

<p>You let MPI know how many different blocks, or chunks of memory there are, their lengths, their offsets and types, and then what variable to store the resulting integer handle in.  So if we had a struct:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
</span><span class="line">    <span class="kt">int</span> <span class="n">var</span><span class="p">;</span>
</span><span class="line">    <span class="kt">char</span> <span class="n">string</span><span class="p">[</span><span class="n">STRING_LENGTH</span><span class="p">];</span>
</span><span class="line">    <span class="kt">double</span> <span class="n">foo</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span> <span class="n">bar</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We would first indicate that there are three blocks, of lengths 1, STRING_LENGTH and 1:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="kt">int</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span><span class="line"><span class="kt">int</span> <span class="n">lengths</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">STRING_LENGTH</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The offsets indicate the byte offsets from the base address of each of the types in the structure.  For this example, the “var” variable is the first, and thus has offset 0.  On the other hand, “string” will have an offset that is sizeof(int), and “foo” will appear after the int and the string of length STRING_LENGTH:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="n">MPI_Aint</span> <span class="n">offsets</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="o">+</span> <span class="n">STRING_LENGTH</span><span class="p">};</span>
</span><span class="line"><span class="n">MPI_Dataype</span> <span class="n">types</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">MPI_INT</span><span class="p">,</span> <span class="n">MPI_CHAR</span><span class="p">,</span> <span class="n">MPI_DOUBLE</span><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>To finish up, we ask MPI to fill an integer we declare with the handle that will hereafter refer to this struct for the purposes of MPI.  Then, we commit it, and it’s ready for use!</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="c++"><span class="line"><span class="cm">/* Corrected by commenter `tinku`: int -&gt; MPI_Datatype */</span>
</span><span class="line"><span class="n">MPI_Datatype</span> <span class="n">barDatatype</span><span class="p">;</span>
</span><span class="line"><span class="n">MPI_Type_struct</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">barDatatype</span><span class="p">);</span>
</span><span class="line"><span class="n">MPI_Type_commit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">barDatatype</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Now if you have an array of bar structs, you can use scatterv with it and your new datatype, or bcast for that matter.  It’s business as usual, as if it were any of the include base datatypes in MPI.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/10/11/running-sudo-with-pssh/">Running sudo with pssh</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/07/21/rough-array-hash-benchmark/">Rough Array Hash Benchmark</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/20/taskmaster-from-disqus/">Taskmaster from DISQUS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/05/18/seomoz-blog-post-introducing-qless/">SEOmoz Blog Post &#8211; Introducing qless</a>
      </li>
    
      <li class="post">
        <a href="/blog/2012/03/11/redis-and-lua-for-robust-portable-libraries/">Redis and Lua for Robust, Portable Libraries</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/dlecocq">@dlecocq</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'dlecocq',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Your Name -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
